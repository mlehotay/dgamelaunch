# howto build & deploy dgamelaunch & NetHack on illithid
# also see https://github.com/mlehotay/NetHack/blob/NetHack-3.7/sys/unix/Install.avocado

cd ~/build
git clone https://github.com/mlehotay/NetHack.git nethack
git clone https://github.com/mlehotay/dgamelaunch.git
--
cd /opt/dgl
sudo tar -czf ~/backup/illithid.yyyy-mm-dd.tar.gz dgldir/ mail/ nh370/var/
sudo rm -rf /opt/dgl
cd ~/build/nethack
git pull
make spotless
cd sys/unix
sh setup.sh hints/floatingeye
cd ../..
make fetch-Lua
make all
cd ~/build/dgamelaunch
git pull
make clean
./autogen.sh --enable-sqlite --enable-shmem --with-config-file=/opt/dgl/etc/dgamelaunch.conf
make
sudo ./dgl-create-chroot
cd ../nethack/
sudo make install
cd /opt/dgl
sudo chown -R games:games nh370/
sudo tar -xzf ~/backup/illithid.yyyy-mm-dd.tar.gz
sudo chroot ./ nh370/nethack # test if can play games as root
ssh rogue@illithid.floatingeye.net
--
# configure ssh
cd /etc/ssh
sudo pico sshd_config
sudo systemctl restart ssh
--
# set timezone
sudo timedatectl set-timezone America/Toronto
--
# backup data
# need sudo for now because of permisssions on NH playground files
# plan to fix perms so backup doesn't need sudo
cd /opt/dgl
sudo tar -czf ~/backup/illithid.yyyy-mm-dd.tar.gz dgldir/ mail/ nh370/var/
--
# restore data
cd /opt/dgl
sudo tar -xzf ~/backup/illithid.yyyy-mm-dd.tar.gz
--
# recover game for player after crash
# TODO - this doesn't work - player still gets dgl warning about stale process
cd /opt/dgl/nh370
sudo ./recover -d var 5spleen
sudo chown -R games:games var/save/5spleen
--
# restore savefile from backup
cd /opt/dgl/nh370/var/save
sudo cp -p 5spleen.gz.bak 5spleen.gz
